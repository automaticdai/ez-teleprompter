<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EZå­—å¹•æè¯å™¨</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Noto Sans SC', 'SF Pro Display', -apple-system, sans-serif; }
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--range-thumb-bg, #fff);
      border: 2px solid var(--range-thumb-border, rgba(0,0,0,0.3));
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    textarea::-webkit-scrollbar, .settings-panel::-webkit-scrollbar { width: 6px; }
    textarea::-webkit-scrollbar-track, .settings-panel::-webkit-scrollbar-track {
      background: var(--scrollbar-track, rgba(255,255,255,0.05));
      border-radius: 3px;
    }
    textarea::-webkit-scrollbar-thumb, .settings-panel::-webkit-scrollbar-thumb {
      background: var(--scrollbar-thumb, rgba(255,255,255,0.2));
      border-radius: 3px;
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;
    const STORAGE_KEY = 'ez-teleprompter:v1';
    const DEFAULT_TEXT = `æ¬¢è¿ä½¿ç”¨EZå­—å¹•æè¯å™¨
Welcome to Subtitle Marquee

è¿™æ˜¯ä¸€ä¸ªæ”¯æŒè¶…é•¿æ–‡æœ¬çš„å‚ç›´æ»šåŠ¨å­—å¹•ç³»ç»Ÿ
å¯ä»¥ç”¨äºç›´æ’­ã€æ¼”è®²ã€æ´»åŠ¨ç­‰åœºæ™¯

åŠŸèƒ½ç‰¹ç‚¹ï¼š
â€¢ æ”¯æŒè¶…é•¿æ–‡æœ¬æ˜¾ç¤º
â€¢ ä»ä¸Šåˆ°ä¸‹å¹³æ»‘æ»šåŠ¨
â€¢ å¯è°ƒèŠ‚æ»šåŠ¨é€Ÿåº¦
â€¢ å¯æ‹–æ‹½è°ƒæ•´ä½ç½®
â€¢ å¤šç§é¢œè‰²ä¸»é¢˜

æ„Ÿè°¢ä½¿ç”¨ï¼âœ¨`;
    const clamp = (value, min, max) => Math.min(max, Math.max(min, value));
    const getSavedSettings = () => {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : {};
      } catch {
        return {};
      }
    };
    const pickNumber = (value, fallback) =>
      typeof value === 'number' && Number.isFinite(value) ? value : fallback;
    const pickBoolean = (value, fallback) =>
      typeof value === 'boolean' ? value : fallback;
    const pickString = (value, fallback) =>
      typeof value === 'string' ? value : fallback;
    const pickPoint = (value, fallback) =>
      value && typeof value === 'object'
        ? {
            x: pickNumber(value.x, fallback.x),
            y: pickNumber(value.y, fallback.y)
          }
        : fallback;
    const pickSize = (value, fallback) =>
      value && typeof value === 'object'
        ? {
            width: pickNumber(value.width, fallback.width),
            height: pickNumber(value.height, fallback.height)
          }
        : fallback;

    const SubtitleMarquee = () => {
      const savedSettingsRef = useRef(getSavedSettings());
      const savedSettings = savedSettingsRef.current;
      const [text, setText] = useState(pickString(savedSettings.text, DEFAULT_TEXT));
      const [speed, setSpeed] = useState(clamp(pickNumber(savedSettings.speed, 50), 1, 100));
      const [fontSize, setFontSize] = useState(clamp(pickNumber(savedSettings.fontSize, 32), 16, 72));
      const [textColor, setTextColor] = useState(pickString(savedSettings.textColor, '#ffffff'));
      const [bgColor, setBgColor] = useState(pickString(savedSettings.bgColor, '#000000'));
      const [bgOpacity, setBgOpacity] = useState(clamp(pickNumber(savedSettings.bgOpacity, 90), 0, 100));
      const [position, setPosition] = useState(pickPoint(savedSettings.position, { x: 50, y: 50 }));
      const [size, setSize] = useState(pickSize(savedSettings.size, { width: 500, height: 300 }));
      const [showSettings, setShowSettings] = useState(pickBoolean(savedSettings.showSettings, true));
      const [isDarkMode, setIsDarkMode] = useState(pickBoolean(savedSettings.isDarkMode, true));
      const [isDragging, setIsDragging] = useState(false);
      const [isResizing, setIsResizing] = useState(false);
      const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
      const [isPaused, setIsPaused] = useState(pickBoolean(savedSettings.isPaused, false));
      const [lineHeight, setLineHeight] = useState(clamp(pickNumber(savedSettings.lineHeight, 1.8), 1.2, 3.0));
      const [skipEmptyLines, setSkipEmptyLines] = useState(pickBoolean(savedSettings.skipEmptyLines, false));
      const [paragraphGap, setParagraphGap] = useState(clamp(pickNumber(savedSettings.paragraphGap, 0.5), 0.2, 3.0));
      
      const containerRef = useRef(null);
      const textRef = useRef(null);
      const animationRef = useRef(null);
      const lastFrameTimeRef = useRef(null);
      const scrollPositionRef = useRef(0);

      const paragraphs = skipEmptyLines 
        ? text.split(/\n\s*\n+/).map(p => p.trim()).filter(p => p !== '')
        : null;

      const applyScrollTransform = useCallback((scrollPos = scrollPositionRef.current) => {
        if (textRef.current) {
          textRef.current.style.transform = `translateY(${size.height - 60 - scrollPos}px)`;
        }
      }, [size.height]);

      const getTextHeight = useCallback(() => {
        if (textRef.current) {
          return textRef.current.scrollHeight;
        }
        return 0;
      }, []);

      const getTotalScroll = useCallback(() => {
        const containerHeight = size.height - 40;
        return getTextHeight() + containerHeight;
      }, [getTextHeight, size.height]);

      useEffect(() => {
        applyScrollTransform();
      }, [applyScrollTransform, text, fontSize, lineHeight, skipEmptyLines, paragraphGap]);

      useEffect(() => {
        const totalScroll = getTotalScroll();
        scrollPositionRef.current = clamp(scrollPositionRef.current, 0, totalScroll);
        applyScrollTransform();
      }, [getTotalScroll, applyScrollTransform, text, fontSize, lineHeight, skipEmptyLines, paragraphGap, size.height]);

      useEffect(() => {
        if (isPaused) {
          if (animationRef.current) {
            cancelAnimationFrame(animationRef.current);
          }
          lastFrameTimeRef.current = null;
          return;
        }

        const minPixelsPerSecond = 5;
        const maxPixelsPerSecond = 240;
        const pixelsPerSecond = minPixelsPerSecond + ((speed - 1) / 99) * (maxPixelsPerSecond - minPixelsPerSecond);

        const animate = (timestamp) => {
          if (lastFrameTimeRef.current === null) {
            lastFrameTimeRef.current = timestamp;
          }

          const deltaSeconds = (timestamp - lastFrameTimeRef.current) / 1000;
          lastFrameTimeRef.current = timestamp;

          const totalScroll = getTotalScroll();
          let nextPosition = scrollPositionRef.current + pixelsPerSecond * deltaSeconds;
          if (nextPosition > totalScroll) {
            nextPosition = 0;
          }
          scrollPositionRef.current = nextPosition;
          applyScrollTransform(nextPosition);
          animationRef.current = requestAnimationFrame(animate);
        };

        animationRef.current = requestAnimationFrame(animate);

        return () => {
          if (animationRef.current) {
            cancelAnimationFrame(animationRef.current);
          }
          lastFrameTimeRef.current = null;
        };
      }, [isPaused, speed, getTotalScroll, applyScrollTransform]);

      const handlePointerDown = useCallback((e) => {
        if (e.target.closest('.settings-panel') || e.target.closest('.resize-handle')) return;
        e.preventDefault();
        setIsDragging(true);
        setDragOffset({
          x: e.clientX - position.x,
          y: e.clientY - position.y
        });
      }, [position]);

      const handleResizeStart = useCallback((e) => {
        e.stopPropagation();
        e.preventDefault();
        setIsResizing(true);
        setDragOffset({
          x: e.clientX,
          y: e.clientY
        });
      }, []);

      const handlePointerMove = useCallback((e) => {
        if (isDragging) {
          const newX = e.clientX - dragOffset.x;
          const newY = e.clientY - dragOffset.y;
          const maxX = Math.max(0, window.innerWidth - size.width);
          const maxY = Math.max(0, window.innerHeight - size.height);
          setPosition({
            x: clamp(newX, 0, maxX),
            y: clamp(newY, 0, maxY)
          });
        } else if (isResizing) {
          const deltaX = e.clientX - dragOffset.x;
          const deltaY = e.clientY - dragOffset.y;
          setSize(prev => ({
            width: Math.max(300, prev.width + deltaX),
            height: Math.max(150, prev.height + deltaY)
          }));
          setDragOffset({
            x: e.clientX,
            y: e.clientY
          });
        }
      }, [isDragging, isResizing, dragOffset, size]);

      const handlePointerUp = useCallback(() => {
        setIsDragging(false);
        setIsResizing(false);
      }, []);

      useEffect(() => {
        window.addEventListener('pointermove', handlePointerMove);
        window.addEventListener('pointerup', handlePointerUp);
        return () => {
          window.removeEventListener('pointermove', handlePointerMove);
          window.removeEventListener('pointerup', handlePointerUp);
        };
      }, [handlePointerMove, handlePointerUp]);

      const resetScroll = useCallback(() => {
        scrollPositionRef.current = 0;
        applyScrollTransform(0);
      }, [applyScrollTransform]);

      const handleWheel = useCallback((e) => {
        e.preventDefault();
        const scrollAmount = e.deltaY * 0.5;
        const totalScroll = getTotalScroll();
        const newPos = clamp(scrollPositionRef.current + scrollAmount, 0, totalScroll);
        scrollPositionRef.current = newPos;
        applyScrollTransform(newPos);
      }, [getTotalScroll, applyScrollTransform]);

      useEffect(() => {
        const onKeyDown = (e) => {
          const target = e.target;
          if (target && (target.tagName === 'TEXTAREA' || target.tagName === 'INPUT' || target.isContentEditable)) {
            return;
          }

          if (e.code === 'Space') {
            e.preventDefault();
            setIsPaused(prev => !prev);
          } else if (e.code === 'KeyR') {
            e.preventDefault();
            resetScroll();
          } else if (e.code === 'ArrowUp') {
            e.preventDefault();
            setSpeed(prev => clamp(prev + 2, 1, 100));
          } else if (e.code === 'ArrowDown') {
            e.preventDefault();
            setSpeed(prev => clamp(prev - 2, 1, 100));
          } else if (e.code === 'ArrowRight') {
            e.preventDefault();
            setFontSize(prev => clamp(prev + 2, 16, 72));
          } else if (e.code === 'ArrowLeft') {
            e.preventDefault();
            setFontSize(prev => clamp(prev - 2, 16, 72));
          } else if (e.code === 'KeyS') {
            e.preventDefault();
            setShowSettings(prev => !prev);
          } else if (e.code === 'KeyD') {
            e.preventDefault();
            setIsDarkMode(prev => !prev);
          }
        };

        window.addEventListener('keydown', onKeyDown);
        return () => window.removeEventListener('keydown', onKeyDown);
      }, [resetScroll]);

      useEffect(() => {
        try {
          localStorage.setItem(
            STORAGE_KEY,
            JSON.stringify({
              text,
              speed,
              fontSize,
              textColor,
              bgColor,
              bgOpacity,
              position,
              size,
              showSettings,
              isDarkMode,
              isPaused,
              lineHeight,
              skipEmptyLines,
              paragraphGap
            })
          );
        } catch {
          // Ignore storage failures (private mode / quota).
        }
      }, [
        text,
        speed,
        fontSize,
        textColor,
        bgColor,
        bgOpacity,
        position,
        size,
        showSettings,
        isDarkMode,
        isPaused,
        lineHeight,
        skipEmptyLines,
        paragraphGap
      ]);

      const colorPresets = [
        { text: '#00ff88', bg: '#0a0a0f', name: 'éœ“è™¹ç»¿' },
        { text: '#ff6b6b', bg: '#1a0a0a', name: 'çƒ­æƒ…çº¢' },
        { text: '#4ecdc4', bg: '#0a1a1a', name: 'é’ç¢§è“' },
        { text: '#ffd93d', bg: '#1a1a0a', name: 'é‡‘è‰²' },
        { text: '#ffffff', bg: '#000000', name: 'ç»å…¸é»‘ç™½' },
        { text: '#ff00ff', bg: '#0f0a1a', name: 'èµ›åšç²‰' },
      ];

      const hexToRgba = (hex, alpha) => {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
      };
      const isHexLight = (hex) => {
        if (!/^#[0-9a-fA-F]{6}$/.test(hex)) return false;
        const r = parseInt(hex.slice(1, 3), 16) / 255;
        const g = parseInt(hex.slice(3, 5), 16) / 255;
        const b = parseInt(hex.slice(5, 7), 16) / 255;
        const luminance = 0.2126 * r + 0.7152 * g + 0.0722 * b;
        return luminance > 0.72;
      };

      const ui = isDarkMode
        ? {
            appBackground: 'linear-gradient(135deg, #0f0f1a 0%, #1a1a2e 50%, #0f0f1a 100%)',
            appOverlay: `
              radial-gradient(circle at 20% 80%, rgba(0, 255, 136, 0.05) 0%, transparent 40%),
              radial-gradient(circle at 80% 20%, rgba(255, 107, 107, 0.05) 0%, transparent 40%)
            `,
            panelBackground: 'rgba(15, 15, 26, 0.95)',
            panelShadow: '0 20px 60px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.1)',
            panelBorder: '1px solid rgba(255,255,255,0.1)',
            panelText: '#fff',
            mutedText: 'rgba(255,255,255,0.6)',
            fieldBackground: 'rgba(255,255,255,0.05)',
            fieldBorder: '1px solid rgba(255,255,255,0.1)',
            fieldText: '#fff',
            sliderTrack: 'rgba(255,255,255,0.1)',
            buttonBackground: 'rgba(255,255,255,0.1)',
            buttonText: '#fff',
            hintBackground: 'rgba(255,255,255,0.03)',
            hintText: 'rgba(255,255,255,0.4)',
            switchOff: 'rgba(255,255,255,0.1)',
            switchKnob: '#fff',
            scrollbarTrack: 'rgba(255,255,255,0.08)',
            scrollbarThumb: 'rgba(255,255,255,0.28)',
            rangeThumbBg: '#ffffff',
            rangeThumbBorder: 'rgba(0,0,0,0.35)'
          }
        : {
            appBackground: 'linear-gradient(135deg, #f7f9ff 0%, #edf3ff 52%, #fdf8f3 100%)',
            appOverlay: `
              radial-gradient(circle at 20% 80%, rgba(41, 128, 185, 0.10) 0%, transparent 42%),
              radial-gradient(circle at 80% 20%, rgba(46, 204, 113, 0.08) 0%, transparent 42%)
            `,
            panelBackground: 'rgba(255,255,255,0.92)',
            panelShadow: '0 20px 60px rgba(20,30,50,0.18), inset 0 1px 0 rgba(255,255,255,0.8)',
            panelBorder: '1px solid rgba(30,45,70,0.14)',
            panelText: '#111827',
            mutedText: 'rgba(17,24,39,0.65)',
            fieldBackground: 'rgba(17,24,39,0.04)',
            fieldBorder: '1px solid rgba(17,24,39,0.14)',
            fieldText: '#0f172a',
            sliderTrack: 'rgba(15,23,42,0.16)',
            buttonBackground: 'rgba(15,23,42,0.10)',
            buttonText: '#111827',
            hintBackground: 'rgba(17,24,39,0.04)',
            hintText: 'rgba(17,24,39,0.58)',
            switchOff: 'rgba(15,23,42,0.16)',
            switchKnob: '#f8fafc',
            scrollbarTrack: 'rgba(15,23,42,0.12)',
            scrollbarThumb: 'rgba(15,23,42,0.42)',
            rangeThumbBg: '#1f2937',
            rangeThumbBorder: 'rgba(255,255,255,0.55)'
          };
      const uiAccentText = !isDarkMode && isHexLight(textColor) ? '#1f2937' : textColor;

      return (
        <div style={{
          minHeight: '100vh',
          background: ui.appBackground,
          overflow: 'hidden',
          position: 'relative'
        }}>
          <div style={{
            position: 'absolute',
            inset: 0,
            background: ui.appOverlay,
            pointerEvents: 'none'
          }} />

          <div
            ref={containerRef}
            onPointerDown={handlePointerDown}
            onWheel={handleWheel}
            style={{
              position: 'fixed',
              left: position.x,
              top: position.y,
              width: size.width,
              height: size.height,
              zIndex: 9999,
              cursor: isDragging ? 'grabbing' : 'grab',
              background: hexToRgba(bgColor, bgOpacity / 100),
              borderRadius: '16px',
              boxShadow: `0 0 40px ${hexToRgba(textColor, 0.3)}, inset 0 1px 0 rgba(255,255,255,0.1)`,
              border: `1px solid ${hexToRgba(textColor, 0.2)}`,
              overflow: 'hidden',
              transition: 'box-shadow 0.3s ease',
              backdropFilter: 'blur(10px)',
              display: 'flex',
              flexDirection: 'column',
              touchAction: 'none'
            }}
          >
            <div style={{
              padding: '8px 16px',
              borderBottom: `1px solid ${hexToRgba(textColor, 0.1)}`,
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'space-between',
              flexShrink: 0
            }}>
              <div style={{
                width: '40px',
                height: '4px',
                background: hexToRgba(textColor, 0.3),
                borderRadius: '2px'
              }} />
            </div>

            <div style={{
              flex: 1,
              overflow: 'hidden',
              position: 'relative',
              padding: '20px'
            }}>
              <div style={{
                position: 'absolute',
                top: 0,
                left: 0,
                right: 0,
                height: '40px',
                background: `linear-gradient(to bottom, ${hexToRgba(bgColor, bgOpacity / 100)}, transparent)`,
                zIndex: 2,
                pointerEvents: 'none'
              }} />
              
              <div style={{
                position: 'absolute',
                bottom: 0,
                left: 0,
                right: 0,
                height: '40px',
                background: `linear-gradient(to top, ${hexToRgba(bgColor, bgOpacity / 100)}, transparent)`,
                zIndex: 2,
                pointerEvents: 'none'
              }} />

              <div
                ref={textRef}
                style={{
                  fontSize: `${fontSize}px`,
                  fontWeight: 500,
                  color: textColor,
                  textShadow: `0 0 20px ${hexToRgba(textColor, 0.4)}`,
                  lineHeight: lineHeight,
                  whiteSpace: 'pre-wrap',
                  wordBreak: 'break-word',
                  transform: `translateY(${size.height - 60}px)`
                }}
              >
                {skipEmptyLines ? (
                  paragraphs.map((para, index) => (
                    <div 
                      key={index} 
                      style={{ 
                        marginBottom: index < paragraphs.length - 1 ? `${paragraphGap}em` : 0 
                      }}
                    >
                      {para}
                    </div>
                  ))
                ) : (
                  text
                )}
              </div>
            </div>

            <div
              className="resize-handle"
              onPointerDown={handleResizeStart}
              style={{
                position: 'absolute',
                bottom: 0,
                right: 0,
                width: '20px',
                height: '20px',
                cursor: 'nwse-resize',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                touchAction: 'none'
              }}
            >
              <svg width="12" height="12" viewBox="0 0 12 12" fill={hexToRgba(textColor, 0.4)}>
                <path d="M11 11L1 11L11 1L11 11Z" />
              </svg>
            </div>
          </div>

          <button
            onClick={() => setShowSettings(!showSettings)}
            aria-label={showSettings ? 'å…³é—­è®¾ç½®é¢æ¿' : 'æ‰“å¼€è®¾ç½®é¢æ¿'}
            title={showSettings ? 'å…³é—­è®¾ç½® (S)' : 'æ‰“å¼€è®¾ç½® (S)'}
            style={{
              position: 'fixed',
              bottom: '20px',
              right: '20px',
              zIndex: 10000,
              width: '56px',
              height: '56px',
              borderRadius: '50%',
              background: `linear-gradient(135deg, ${textColor}, ${hexToRgba(textColor, 0.7)})`,
              border: 'none',
              cursor: 'pointer',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              boxShadow: `0 4px 20px ${hexToRgba(textColor, 0.4)}`,
              transition: 'transform 0.3s ease, box-shadow 0.3s ease',
              fontSize: '24px'
            }}
          >
            {showSettings ? 'âœ•' : 'âš™'}
          </button>

          {showSettings && (
            <div 
              className="settings-panel"
              style={{
                position: 'fixed',
                bottom: '90px',
                right: '20px',
                zIndex: 10000,
                width: '360px',
                maxHeight: 'calc(100vh - 140px)',
                overflowY: 'auto',
                background: ui.panelBackground,
                borderRadius: '20px',
                padding: '24px',
                boxShadow: ui.panelShadow,
                border: ui.panelBorder,
                backdropFilter: 'blur(20px)',
                animation: 'slideUp 0.3s ease',
                '--scrollbar-track': ui.scrollbarTrack,
                '--scrollbar-thumb': ui.scrollbarThumb,
                '--range-thumb-bg': ui.rangeThumbBg,
                '--range-thumb-border': ui.rangeThumbBorder
              }}
            >
              <h2 style={{
                margin: '0 0 20px 0',
                fontSize: '18px',
                fontWeight: 700,
                color: ui.panelText,
                display: 'flex',
                alignItems: 'center',
                gap: '10px'
              }}>
                <span style={{ fontSize: '24px' }}>ğŸ¬</span>
                EZå­—å¹•æè¯å™¨è®¾ç½®
              </h2>

              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '8px',
                  fontSize: '12px',
                  color: ui.mutedText,
                  textTransform: 'uppercase',
                  letterSpacing: '1px'
                }}>
                  å­—å¹•æ–‡æœ¬ï¼ˆæ”¯æŒè¶…é•¿æ–‡æœ¬ï¼‰
                </label>
                <textarea
                  value={text}
                  onChange={(e) => setText(e.target.value)}
                  aria-label="å­—å¹•æ–‡æœ¬"
                  placeholder="åœ¨æ­¤è¾“å…¥å­—å¹•å†…å®¹ï¼Œæ”¯æŒå¤šè¡Œè¶…é•¿æ–‡æœ¬..."
                  style={{
                    width: '100%',
                    padding: '12px',
                    background: ui.fieldBackground,
                    border: ui.fieldBorder,
                    borderRadius: '10px',
                    color: ui.fieldText,
                    fontSize: '14px',
                    resize: 'vertical',
                    minHeight: '120px',
                    outline: 'none',
                    transition: 'border-color 0.3s ease',
                    boxSizing: 'border-box',
                    lineHeight: 1.6
                  }}
                />
              </div>

              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  marginBottom: '8px',
                  fontSize: '12px',
                  color: ui.mutedText,
                  textTransform: 'uppercase',
                  letterSpacing: '1px'
                }}>
                  <span>æ»šåŠ¨é€Ÿåº¦</span>
                  <span style={{ color: uiAccentText }}>{speed}%</span>
                </label>
                <input
                  type="range"
                  min="1"
                  max="100"
                  value={speed}
                  onChange={(e) => setSpeed(Number(e.target.value))}
                  aria-label="æ»šåŠ¨é€Ÿåº¦"
                  style={{
                    width: '100%',
                    height: '6px',
                    borderRadius: '3px',
                    background: `linear-gradient(to right, ${textColor} ${speed}%, ${ui.sliderTrack} ${speed}%)`,
                    appearance: 'none',
                    cursor: 'pointer'
                  }}
                />
              </div>

              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  marginBottom: '8px',
                  fontSize: '12px',
                  color: ui.mutedText,
                  textTransform: 'uppercase',
                  letterSpacing: '1px'
                }}>
                  <span>å­—ä½“å¤§å°</span>
                  <span style={{ color: uiAccentText }}>{fontSize}px</span>
                </label>
                <input
                  type="range"
                  min="16"
                  max="72"
                  value={fontSize}
                  onChange={(e) => setFontSize(Number(e.target.value))}
                  aria-label="å­—ä½“å¤§å°"
                  style={{
                    width: '100%',
                    height: '6px',
                    borderRadius: '3px',
                    background: `linear-gradient(to right, ${textColor} ${((fontSize - 16) / 56) * 100}%, ${ui.sliderTrack} ${((fontSize - 16) / 56) * 100}%)`,
                    appearance: 'none',
                    cursor: 'pointer'
                  }}
                />
              </div>

              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  marginBottom: '8px',
                  fontSize: '12px',
                  color: ui.mutedText,
                  textTransform: 'uppercase',
                  letterSpacing: '1px'
                }}>
                  <span>è¡Œé«˜</span>
                  <span style={{ color: uiAccentText }}>{lineHeight.toFixed(1)}</span>
                </label>
                <input
                  type="range"
                  min="12"
                  max="30"
                  value={lineHeight * 10}
                  onChange={(e) => setLineHeight(Number(e.target.value) / 10)}
                  aria-label="è¡Œé«˜"
                  style={{
                    width: '100%',
                    height: '6px',
                    borderRadius: '3px',
                    background: `linear-gradient(to right, ${textColor} ${((lineHeight - 1.2) / 1.8) * 100}%, ${ui.sliderTrack} ${((lineHeight - 1.2) / 1.8) * 100}%)`,
                    appearance: 'none',
                    cursor: 'pointer'
                  }}
                />
              </div>

              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  marginBottom: '8px',
                  fontSize: '12px',
                  color: ui.mutedText,
                  textTransform: 'uppercase',
                  letterSpacing: '1px'
                }}>
                  <span>èƒŒæ™¯é€æ˜åº¦</span>
                  <span style={{ color: uiAccentText }}>{bgOpacity}%</span>
                </label>
                <input
                  type="range"
                  min="0"
                  max="100"
                  value={bgOpacity}
                  onChange={(e) => setBgOpacity(Number(e.target.value))}
                  aria-label="èƒŒæ™¯é€æ˜åº¦"
                  style={{
                    width: '100%',
                    height: '6px',
                    borderRadius: '3px',
                    background: `linear-gradient(to right, ${textColor} ${bgOpacity}%, ${ui.sliderTrack} ${bgOpacity}%)`,
                    appearance: 'none',
                    cursor: 'pointer'
                  }}
                />
              </div>

              <div style={{ marginBottom: '20px' }}>
                <button
                  type="button"
                  style={{
                    width: '100%',
                    border: 'none',
                    background: 'transparent',
                    padding: 0,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    cursor: 'pointer'
                  }}
                  onClick={() => setSkipEmptyLines(!skipEmptyLines)}
                  role="switch"
                  aria-checked={skipEmptyLines}
                  aria-label="è·³è¿‡ç©ºè¡Œ"
                >
                  <span style={{
                    fontSize: '12px',
                    color: ui.mutedText,
                    textTransform: 'uppercase',
                    letterSpacing: '1px'
                  }}>
                    è·³è¿‡ç©ºè¡Œ
                  </span>
                  <div style={{
                    width: '44px',
                    height: '24px',
                    borderRadius: '12px',
                    background: skipEmptyLines ? textColor : ui.switchOff,
                    position: 'relative',
                    transition: 'background 0.3s ease'
                  }}>
                    <div style={{
                      width: '18px',
                      height: '18px',
                      borderRadius: '50%',
                      background: ui.switchKnob,
                      position: 'absolute',
                      top: '3px',
                      left: skipEmptyLines ? '23px' : '3px',
                      transition: 'left 0.3s ease',
                      boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                    }} />
                  </div>
                </button>
              </div>

              {skipEmptyLines && (
                <div style={{ marginBottom: '20px' }}>
                  <label style={{
                    display: 'flex',
                    justifyContent: 'space-between',
                    marginBottom: '8px',
                    fontSize: '12px',
                    color: ui.mutedText,
                    textTransform: 'uppercase',
                    letterSpacing: '1px'
                  }}>
                    <span>æ®µè½é—´è·</span>
                    <span style={{ color: uiAccentText }}>{paragraphGap.toFixed(1)}em</span>
                  </label>
                  <input
                    type="range"
                    min="2"
                    max="30"
                    value={paragraphGap * 10}
                    onChange={(e) => setParagraphGap(Number(e.target.value) / 10)}
                    aria-label="æ®µè½é—´è·"
                    style={{
                      width: '100%',
                      height: '6px',
                      borderRadius: '3px',
                      background: `linear-gradient(to right, ${textColor} ${((paragraphGap - 0.2) / 2.8) * 100}%, ${ui.sliderTrack} ${((paragraphGap - 0.2) / 2.8) * 100}%)`,
                      appearance: 'none',
                      cursor: 'pointer'
                    }}
                  />
                </div>
              )}

              <div style={{ marginBottom: '20px' }}>
                <label style={{
                  display: 'block',
                  marginBottom: '10px',
                  fontSize: '12px',
                  color: ui.mutedText,
                  textTransform: 'uppercase',
                  letterSpacing: '1px'
                }}>
                  é¢œè‰²æ–¹æ¡ˆ
                </label>
                <div style={{
                  display: 'grid',
                  gridTemplateColumns: 'repeat(3, 1fr)',
                  gap: '8px'
                }}>
                  {colorPresets.map((preset, index) => (
                    <button
                      key={index}
                      aria-label={`ä½¿ç”¨é¢œè‰²æ–¹æ¡ˆ ${preset.name}`}
                      onClick={() => {
                        setTextColor(preset.text);
                        setBgColor(preset.bg);
                      }}
                      style={{
                        padding: '10px 8px',
                        borderRadius: '10px',
                        border: textColor === preset.text ? `2px solid ${preset.text}` : '2px solid transparent',
                        background: preset.bg,
                        cursor: 'pointer',
                        transition: 'all 0.3s ease'
                      }}
                    >
                      <div style={{
                        width: '100%',
                        height: '4px',
                        background: preset.text,
                        borderRadius: '2px',
                        marginBottom: '6px',
                        boxShadow: `0 0 10px ${preset.text}`
                      }} />
                      <span style={{
                        fontSize: '10px',
                        color: preset.text,
                        fontWeight: 600
                      }}>
                        {preset.name}
                      </span>
                    </button>
                  ))}
                </div>
              </div>

              <div style={{
                display: 'grid',
                gridTemplateColumns: '1fr 1fr',
                gap: '10px'
              }}>
                <button
                  onClick={() => setIsPaused(!isPaused)}
                  aria-label={isPaused ? 'æ’­æ”¾' : 'æš‚åœ'}
                  title="ç©ºæ ¼é”®åˆ‡æ¢æ’­æ”¾/æš‚åœ"
                  style={{
                    padding: '14px 8px',
                    borderRadius: '12px',
                    border: 'none',
                    background: isPaused 
                      ? `linear-gradient(135deg, ${textColor}, ${hexToRgba(textColor, 0.7)})` 
                      : ui.buttonBackground,
                    color: isPaused ? bgColor : ui.buttonText,
                    fontSize: '12px',
                    fontWeight: 600,
                    cursor: 'pointer',
                    transition: 'all 0.3s ease',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '4px'
                  }}
                >
                  {isPaused ? 'â–¶ æ’­æ”¾' : 'â¸ æš‚åœ'}
                </button>
                <button
                  onClick={resetScroll}
                  aria-label="é‡ç½®åˆ°å¼€å¤´"
                  title="é‡ç½® (R)"
                  style={{
                    padding: '14px 8px',
                    borderRadius: '12px',
                    border: 'none',
                    background: ui.buttonBackground,
                    color: ui.buttonText,
                    fontSize: '12px',
                    fontWeight: 600,
                    cursor: 'pointer',
                    transition: 'all 0.3s ease',
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'center',
                    gap: '4px'
                  }}
                >
                  â†º é‡ç½®
                </button>
              </div>

              <div style={{ marginTop: '10px', marginBottom: '6px' }}>
                <button
                  type="button"
                  onClick={() => setIsDarkMode(!isDarkMode)}
                  role="switch"
                  aria-checked={isDarkMode}
                  aria-label={isDarkMode ? 'åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼' : 'åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼'}
                  title="åˆ‡æ¢ä¸»é¢˜ (D)"
                  style={{
                    width: '100%',
                    border: 'none',
                    background: 'transparent',
                    padding: 0,
                    display: 'flex',
                    alignItems: 'center',
                    justifyContent: 'space-between',
                    cursor: 'pointer'
                  }}
                >
                  <span style={{
                    fontSize: '12px',
                    color: ui.mutedText,
                    textTransform: 'uppercase',
                    letterSpacing: '1px'
                  }}>
                    æ˜æš—æ¨¡å¼
                  </span>
                  <div style={{
                    width: '52px',
                    height: '28px',
                    borderRadius: '14px',
                    background: isDarkMode ? textColor : ui.switchOff,
                    position: 'relative',
                    transition: 'background 0.3s ease'
                  }}>
                    <div style={{
                      width: '22px',
                      height: '22px',
                      borderRadius: '50%',
                      background: ui.switchKnob,
                      position: 'absolute',
                      top: '3px',
                      left: isDarkMode ? '27px' : '3px',
                      transition: 'left 0.3s ease',
                      boxShadow: '0 2px 4px rgba(0,0,0,0.2)'
                    }} />
                  </div>
                </button>
              </div>

              <div style={{
                marginTop: '16px',
                padding: '12px',
                background: ui.hintBackground,
                borderRadius: '10px',
                fontSize: '11px',
                color: ui.hintText,
                lineHeight: 1.6
              }}>
                ğŸ’¡ æç¤ºï¼šæ‹–æ‹½çª—å£è°ƒæ•´ä½ç½®ï¼Œæ‹–æ‹½å³ä¸‹è§’è°ƒæ•´å¤§å°ï¼Œæ»šè½®æµè§ˆæ–‡æœ¬ã€‚
                å¿«æ·é”®ï¼šSpace æ’­æ”¾/æš‚åœï¼ŒR é‡ç½®ï¼Œâ†‘/â†“ è°ƒé€Ÿåº¦ï¼Œâ†/â†’ è°ƒå­—å·ï¼ŒS å¼€å…³è®¾ç½®ï¼ŒD æ˜æš—æ¨¡å¼ã€‚
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<SubtitleMarquee />);
  </script>
</body>
</html>
